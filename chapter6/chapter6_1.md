# 6.1 백업 소개

> Enterprise Edition 전용입니다.
>
> 이번 섹션에서는 Neo4j Database의 백업에 대해 알아보겠습니다.

Neo4j 데이터베이스를 원격 또는 별도 저장소에 백업하는 기능은 데이터베이스 운영에 있어서 기본적인 것 입니다. 백업 전략은 각자의 특수한 요구사항에 맞게 끔 디자인이 되어야 합니다. 요구사항에는 성능, 백업으로 인한 시스템중지시간 또는 네트워크나 하드웨어 실패로 인한 데이터 손실의 허용수준 등이 있을 것 입니다. 만약 Neo4j를 Causal Cluster 방식으로 동작하는 경우에는 백업 전략이 모든 클러스터를 수용할 수 있게끔 되어야 합니다.

[Neo4j](#chapter612)는 전체 또는 증분방식의 백업을 지원합니다. 또한 백업 처리과정은 단일 데이터베이스, HA Cluster, Causal Cluster 방식 모두 동일합니다.

## 6.1.1 백업 명령 {#chapter611}

데이터베이스를 백업 및 복구하는 명령은 Neo4j Admin 툴을 활용하여 수행되며 아래와 같습니다.

* `neo4j-admin backup` 전체 또는 증분방식의 백업 수행
* `neo4j-admin restore` 백업 복구

## 6.1.2 백업 활성화 {#chapter612}

백업은 실행중인 Neo4j 서버로부터 데이터베이스 로컬 또는 네트워크 환경에서 수행됩니다. 결과 파일은 로컬 또는 네트워크에 마운트된 디렉터리 또는 백업을 수행하는 서버에 생성됩니다. 백업을 수행하기 위해서는 2개의 파라미터가 설정되어야 합니다.

| 파라미터 이름 | 기본값 | 설명 |
| :--- | :--- | :--- |
| dbms.backup.enabled | true | 온라인 백업 실행 활성여부 |
| dbms.backup.address | 127.0.0.1:6362-6372 | 온라인 백업을 위한 서버 수신주소 |

## 6.1.3 저장소 고려사항 {#chapter613}

어떤 백업이든 운영 시스템과는 별개로 종속성이 없는 별도의 공간에 데이터를 저장하는 것이 중요합니다. 클러스터 서버 외부에 안정적인 저장소, 다른\(네트워크로 연결된\) 저장소, 가장 좋은 것은 별도 지역\(클라우드를 예로 들 경우, 동일 클라우드의 다른 Availability Zone 또는 완전 다른 클라우드\)에 백업을 저장하는 것이 좋습니다. 매우 장기적으로 백업이 보관될 경우에는 저장소의 장기보관 안정성 등이 백업계획에 고려되어야 합니다.

## 6.1.4 메모리 고려사항 {#chapter614}

백업 프로그램이 실행될 때, 새로운 Java 프로세스를 구동하게 됩니다. Neo4j 데이터베이스가 동작하고 있을 경우 Neo4j 프로세스와 동시에 실행될 것 입니다. 운영환경에서는 Neo4j에는 시스템의 가용한 RAM 수준에 따라 최대의 성능에 맞게 설정하였을 것 입니다. 만약 백업을 운영시스템에서 동작하게 되면, 전체적인 성능에 악영향을 주게 될 것 이며 최악의 경우에는 Out-Of-Memory 오류를 발생하게 될 것 입니다. 그렇기 때문에 운영서버가 아닌 다른 서버에서 백업을 수행하길 강력하게 권장드립니다.

Causal Cluster 환경에서의 실행은 복제본을 읽어서 백업을 수행하는 방법도 있습니다. 자세한 내용은 "4.2.5 Causal Cluster 환경에서 백업 계획"에서 다루겠습니다.

별도의 백업서버 구동이 어렵다면, 운영 시스템의 통제를 위하여 백업 프로세스에 얼마 만큼의 메모리를 할당할지 지정한 뒤 실행하시기 바랍니다.

### 백업의 Heap Size 설정

백업 프로그램 실행전에 HEAP\_SIZE 환경변수로 설정이 가능합니다.만약 설정되어있지 않는 경우에는 JVM이 서버의 자원을 확인하고 임의로 지정하게 됩니다.

### 백업의 Page Cache 설정

Page Cache는 `neo4j-admin`의 `backup` 명령을 실행할 때 `--pagecache` 옵션으로 설정할 수 있습니다. 만약 설정되지 않는 경우에는 기본값인 8MB를 사용하게 됩니다.

> 다시한번 강조하지만, 운영서버가 아닌 다른서버에서 백업을 수행하는 것을 권장드립니다.



