# 9.1 메모리 설정

> 이 섹션에서는 Neo4j 인스턴스에 대한 메모리설정을 어떻게 하는지 알아봅니다.
>
> 이 섹션에서 Neo4j의 메모리 관련 설정에 대해 살펴볼 것 입니다. 먼저 다른 사용환경에 따라 메모리사용이 아주 상이한 특성을 가짐을 알아야합니다. 데이터 집합의 크기나 인덱스의 존재 등이 메모리 사용량에 영향을 끼치는 요소의 예가 될 수 있습니다. 그러므로 아래에 제시한 수치는 일반적인 목적에만 해당함을 알려드립니다. Neo4j 설치 환경 및 상황에 따라서 각자에 맞게 사용하셔야 합니다.

아래 이미지를 참조하여 Neo4j 서버의 RAM은 3가지 영역으로 구성되어있습니다.

![](https://neo4j.com/docs/operations-manual/3.3/images/neo4j-memory-management.png)

메모리 설정을 할 때 다음 단계로 진행하길 권장합니다.

1. OS 메모리
   * [OS 메모리](#os-memory) - OS에 사용되는 메모리 추산
   * [Lucene Index Cache](#lucene-index-cache) - Lucene 인덱스에서 사용되는 메모리 추산
2. [Page Cache](#page-cache) - Page Cache 영역 사이즈 결정
3. [Heap Size](#heap-size) - Heap 사이즈 결정
4. [메모리 설정 검증](#메모리-설정-검증) - 설정된 메모리가 사용가능한 RAM에 맞는지 확인

위 단계를 좀 더 자세히 알아보겠습니다.

여기서 설명하는 것은 서버가 Neo4j 전용으로 운영되있음을 가정하였습니다. 만약 다른 서비스가 함께 동작하고 있는 경우에는 각각의 서비스에 대한 메모리 요구사항을 고려하여야 합니다.

## OS 메모리 {#os-memory}

시스템 일부 메모리는 OS 동작을 위하여 할당되어야 합니다. Page Cache와 Heap Space를 할당한 뒤 남은 RAM에 대하여 OS에 특정 수치만큼 할당할 수는 없습니다. 그러나, OS를 위하여 충분한 메모리를 남기지 않는 경우에는 계속적으로 Disk Swapping이 발생하며 성능에 심각한 영향을 끼칩니다.

1GB 정도가 독립적으로 Neo4j를 수행하는 서버에 대한 OS 영역 메모리로 적당합니다.

> 간단하게 OS 메모리를 결정하도록 하겠습니다. 이 섹션에서는 OS 메모리로 1GB 정도가 사용된다고 하겠습니다.

시스템 사용 및 환경\(예로, 매우 큰 RAM 용량을 가진 시스템\)에 따라 1GB 이상의 메모리가 OS에 사용되는 경우도 있습니다.

## Lucene Index Cache {#lucene-index-cache}

Neo4j는 인덱싱 기능을 위하여 [Apache Lucene](https://lucene.apache.org/)을 사용합니다. 인덱스를 메모리 크기에 맞게 설정하여 인덱스 검색 성능을 최적화 할 것 입니다 OS 메모리와 유사하게, Lucene 인덱스 캐시 또한 특정한 수치로 설정할 수 는 없습니다. 대신 필요한 메모리를 측정하여 Page Cache와 Heap Space를 설정하기 전에 선점할 메모리로 계산합니다.

다음 파일명 규칙으로 해당하는 파일의 사이즈 합계를 통하여 Lucene 인덱스 캐시에 사용할 메모리 용량을 측정할 것 입니다.

* NEO4J\_HOME/data/databases/&lt;database-name&gt;/index
* NEO4J\_HOME/data/databases/&lt;database-name&gt;/schema/index/\*/\*/lucene\*



## Page Cache

## Heap Size

## 메모리 설정 검증



