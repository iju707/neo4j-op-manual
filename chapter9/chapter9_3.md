# 9.3 Compressed Storage

> 이번 섹션에서는 Neo4j의 속성 압축과 디스크 사용에 대하여 알아보겠습니다.

Neo4j는 짧은 배열이나 문자열 같은 속성값을 디스크 용량과 가능하면 I/O 동작까지 절약될 수 있도록 많은 경우 압축하고 인라인처리하여 저장합니다.

## 짧은 배열 압축저장

Neo4j는 원시배열에 대하여 압축하는 방법으로 저장합니다. 이것을 위해 "bit-shaving" 이라는 알고리즘을 채용하여 배열항목을 저장하기 위한 bit 수를 줄입니다. 특히:

1. 배열의 각 항목에 대하여, 가장 오른쪽의 비트 위치를 확인합니다.
2. 전체 배열 항목에 대하여 1번 위치가 가장 큰 항목을 결정합니다.
3. 모든 배열의 항목을 2번 위치로 맞게 줄입니다.
4. 줄여진 값을 저장하고 작은 크기의 Header를 추가합니다.

이 의미는 배열에 한개라도 음수의 값이 있다면, 원시자료형의 본래 크기를 사용하게 됩니다.

다음 조건을 만족하면 결과가 속성레코드에 인라인 될 수 있습니다.

* 압축 후 24 바이트 미만
* 64개 미만의 항목

예로들어 `long[] {0L, 1L, 2L, 4L}`이라는 배열이 있다면, 가장큰 항목은 `4L`이 되고 저장하기 위해서 3비트가 필요합니다. 그렇기 때문에 배열을 저장하기 위하여 `4 X 3 = 12` 비트가 소요됩니다. 그러나 `long[] {-1L, 1L, 2L, 4L}`의 경우에는 `-1L`로 인하여 64비트 전체가 필요하게 되며, 전체 배열을 저장하기 위하여 `4 X 64 = 32` 바이트가 필요합니다. 압축 후 24 바이트를 초과하게 되므로 인라인처리되지 않고, 동적 저장소에 저장이 됩니다.

## 짧은 문자열 압축저장

Neo4j는 짧은 문자열 클래스로 문자열을 분류하려고 시도하며, 적절하다면 문자열을 분류할 것 입니다. 

